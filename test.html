<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telugu Reader - Test Page</title>
  <style>
    body {
      font-family: monospace;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f5f5f5;
    }
    h1 { color: #2563eb; }
    .test {
      background: white;
      padding: 1rem;
      margin: 0.5rem 0;
      border-left: 4px solid #ccc;
    }
    .pass { border-left-color: #10b981; }
    .fail { border-left-color: #ef4444; }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      cursor: pointer;
    }
    #results { margin-top: 2rem; }
    .log {
      background: #1f2937;
      color: #10b981;
      padding: 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üß™ Telugu Reader - Test Suite</h1>
  <p>Automated tests for MVP functionality</p>

  <button onclick="runAllTests()">Run All Tests</button>
  <button onclick="location.href='index.html'">Go to App</button>

  <div id="results"></div>

  <script>
    const results = document.getElementById('results');

    async function runAllTests() {
      results.innerHTML = '<div class="log">Running tests...</div>';
      const tests = [];

      // Test 1: Files exist
      tests.push(await testFilesExist());

      // Test 2: Data loads
      tests.push(await testDataLoads());

      // Test 3: IndexedDB available
      tests.push(await testIndexedDB());

      // Test 4: Service Worker registration
      tests.push(await testServiceWorker());

      // Display results
      const passed = tests.filter(t => t.pass).length;
      const total = tests.length;

      results.innerHTML = `
        <h2>Test Results: ${passed}/${total} Passed</h2>
        ${tests.map(t => `
          <div class="test ${t.pass ? 'pass' : 'fail'}">
            ${t.pass ? '‚úÖ' : '‚ùå'} ${t.name}
            <br><small>${t.message}</small>
          </div>
        `).join('')}
      `;
    }

    async function testFilesExist() {
      try {
        const files = ['/', '/styles.css', '/app.js', '/sw.js', '/data/sentences.json', '/data/glossary.json'];
        const results = await Promise.all(files.map(f => fetch(f)));
        const allOk = results.every(r => r.ok);
        return {
          name: 'File Availability',
          pass: allOk,
          message: allOk ? 'All core files accessible' : 'Some files missing'
        };
      } catch (err) {
        return { name: 'File Availability', pass: false, message: err.message };
      }
    }

    async function testDataLoads() {
      try {
        const [sentences, glossary] = await Promise.all([
          fetch('/data/sentences.json').then(r => r.json()),
          fetch('/data/glossary.json').then(r => r.json())
        ]);
        const valid = Array.isArray(sentences) &&
                     sentences.length >= 12 &&
                     Array.isArray(glossary) &&
                     glossary.length >= 10;
        return {
          name: 'Data Validation',
          pass: valid,
          message: valid ? `${sentences.length} sentences, ${glossary.length} terms` : 'Invalid data structure'
        };
      } catch (err) {
        return { name: 'Data Validation', pass: false, message: err.message };
      }
    }

    async function testIndexedDB() {
      try {
        const supported = 'indexedDB' in window;
        if (!supported) throw new Error('IndexedDB not supported');

        // Try to open DB
        const request = indexedDB.open('test_db', 1);
        await new Promise((resolve, reject) => {
          request.onsuccess = resolve;
          request.onerror = reject;
        });
        indexedDB.deleteDatabase('test_db');

        return {
          name: 'IndexedDB Support',
          pass: true,
          message: 'IndexedDB available and working'
        };
      } catch (err) {
        return { name: 'IndexedDB Support', pass: false, message: err.message };
      }
    }

    async function testServiceWorker() {
      try {
        const supported = 'serviceWorker' in navigator;
        return {
          name: 'Service Worker Support',
          pass: supported,
          message: supported ? 'Service Worker API available' : 'Service Worker not supported'
        };
      } catch (err) {
        return { name: 'Service Worker Support', pass: false, message: err.message };
      }
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      console.log('Test page loaded. Click "Run All Tests" to begin.');
    });
  </script>
</body>
</html>
